{
  "$schema": "./schema.json",
  "suite": "CCL Core Hierarchy - Validation Format",
  "version": "2.1",
  "description": "Core CCL hierarchy construction - validates flat entries → nested objects transformation as part of atomic Core CCL.",
  "llm_metadata": {
    "llm_description": "Level 1 Core CCL Hierarchy - object construction from flat entries including nesting, lists, and complex structures (part of atomic Core CCL)",
    "complexity_level": "Level 1 (Core CCL Hierarchy)",
    "prerequisite_tests": ["api-core-ccl-parsing.json"],
    "related_functions": ["build-hierarchy"],
    "implementation_notes": "Core hierarchy construction tests. Validates the object building part of Core CCL atomic operation. Tests assume parsing is working.",
    "test_count": 7,
    "assertion_count": 19,
    "cross_references": {
      "gleam_implementation": "packages/ccl/src/ccl.gleam#build_hierarchy",
      "go_reference": "internal/mock/ccl.go#MakeObjects",
      "ocaml_reference": "Model.fix",
      "documentation": "https://ccl.tylerbutler.com/core-concepts#hierarchy-construction"
    },
    "learning_path": "Requires api-core-ccl-parsing.json → Complete here → api-core-ccl-integration.json"
  },
  "tests": [
    {
      "name": "basic_object_construction",
      "input": "name = Alice\nage = 42",
      "validations": {
        "parse": {
          "count": 2,
          "expected": [
            {"key": "name", "value": "Alice"},
            {"key": "age", "value": "42"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "name": "Alice",
            "age": "42"
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    },
    {
      "name": "single_nested_object",
      "input": "database =\n  enabled = true\n  port = 5432",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {"key": "database", "value": "\n  enabled = true\n  port = 5432"}
          ]
        },
        "expand_dotted": {
          "count": 3,
          "expected": [
            {"key": "database", "value": ""},
            {"key": "database.enabled", "value": "true"},
            {"key": "database.port", "value": "5432"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "database": {
              "enabled": "true",
              "port": "5432"
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    },
    {
      "name": "deep_nested_objects",
      "input": "server =\n  database =\n    host = localhost\n    port = 5432\n  cache =\n    enabled = true",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {"key": "server", "value": "\n  database =\n    host = localhost\n    port = 5432\n  cache =\n    enabled = true"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "server": {
              "database": {
                "host": "localhost",
                "port": "5432"
              },
              "cache": {
                "enabled": "true"
              }
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    },
    {
      "name": "duplicate_keys_to_lists",
      "input": "item = first\nitem = second\nitem = third",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {"key": "item", "value": "first"},
            {"key": "item", "value": "second"},
            {"key": "item", "value": "third"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "item": ["first", "second", "third"]
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    },
    {
      "name": "nested_duplicate_keys",
      "input": "config =\n  server = web1\n  server = web2\n  port = 80",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {"key": "config", "value": "\n  server = web1\n  server = web2\n  port = 80"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "config": {
              "server": ["web1", "web2"],
              "port": "80"
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    },
    {
      "name": "mixed_flat_and_nested",
      "input": "name = Alice\nconfig =\n  debug = true\n  timeout = 30\nversion = 1.0",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {"key": "name", "value": "Alice"},
            {"key": "config", "value": "\n  debug = true\n  timeout = 30"},
            {"key": "version", "value": "1.0"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "name": "Alice",
            "config": {
              "debug": "true",
              "timeout": "30"
            },
            "version": "1.0"
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    },
    {
      "name": "nested_objects_with_lists",
      "input": "environments =\n  prod =\n    server = web1\n    server = web2\n    port = 80\n  dev =\n    server = localhost\n    port = 3000",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {"key": "environments", "value": "\n  prod =\n    server = web1\n    server = web2\n    port = 80\n  dev =\n    server = localhost\n    port = 3000"}
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "environments": {
              "prod": {
                "server": ["web1", "web2"],
                "port": "80"
              },
              "dev": {
                "server": "localhost",
                "port": "3000"
              }
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:parse",
          "function:expand_dotted",
          "function:build_hierarchy"
        ],
        "level": 1,
        "feature": "core_ccl_hierarchy"
      }
    }
  ]
}