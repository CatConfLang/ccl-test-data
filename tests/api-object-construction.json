{
  "$schema": "./schema.json",
  "suite": "CCL Object Construction - Validation Format",
  "version": "2.1",
  "description": "Converting flat Entry[] to nested objects via build_hierarchy() - essential for hierarchical access",
  "llm_metadata": {
    "llm_description": "Level 3 CCL object construction - converts flat entries to nested objects for hierarchical data access",
    "complexity_level": "Level 3",
    "prerequisite_tests": ["api-essential-parsing.json", "api-processing.json"],
    "related_functions": ["make-objects", "build-hierarchy"],
    "implementation_notes": "Level 3 core functionality. Transforms flat key-value pairs into hierarchical objects with proper nesting.",
    "test_count": 9,
    "assertion_count": 29,
    "cross_references": {
      "gleam_implementation": "packages/ccl/src/ccl.gleam#build_hierarchy",
      "go_reference": "internal/mock/ccl.go#MakeObjects",
      "documentation": "https://ccl.tylerbutler.com/api-reference#object-construction"
    },
    "learning_path": "Requires Level 1-2 → Complete here → api-typed-access.json for Level 4"
  },
  "tests": [
    {
      "name": "recursive_nested_single",
      "input": "database =\n  enabled = true",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {
              "key": "database",
              "value": "\n  enabled = true"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "database": {
              "enabled": "true"
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "recursive_nested_multiple",
      "input": "database =\n  host = localhost\n  port = 5432\n  enabled = true",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {
              "key": "database",
              "value": "\n  host = localhost\n  port = 5432\n  enabled = true"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "database": {
              "host": "localhost",
              "port": "5432",
              "enabled": "true"
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "deep_recursive_nesting",
      "input": "server =\n  database =\n    host = localhost\n    port = 5432\n  cache =\n    enabled = true",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {
              "key": "server",
              "value": "\n  database =\n    host = localhost\n    port = 5432\n  cache =\n    enabled = true"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "server": {
              "database": {
                "host": "localhost",
                "port": "5432"
              },
              "cache": {
                "enabled": "true"
              }
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "multiple_keys_same_name_merge",
      "input": "user =\n  name = alice\nuser =\n  age = 25",
      "validations": {
        "parse": {
          "count": 2,
          "expected": [
            {
              "key": "user",
              "value": "\n  name = alice"
            },
            {
              "key": "user",
              "value": "\n  age = 25"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "user": {
              "name": "alice",
              "age": "25"
            }
          }
        }
      },
      "meta": {
        "tags": [
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "empty_key_list_style",
      "input": "ports =\n  = 8000\n  = 8001\n  = 8002",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {
              "key": "ports",
              "value": "\n  = 8000\n  = 8001\n  = 8002"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "ports": {
              "": [
                "8000",
                "8001",
                "8002"
              ]
            }
          }
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "empty_key_top_level",
      "input": "= root_value\nkey = normal\n= another_root",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "",
              "value": "root_value"
            },
            {
              "key": "key",
              "value": "normal"
            },
            {
              "key": "",
              "value": "another_root"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "": [
              "root_value",
              "another_root"
            ],
            "key": "normal"
          }
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:build-hierarchy",
          "function:parse",
          "variant:proposed-behavior"
        ],
        "level": 3,
        "feature": "object-construction",
        "conflicts": [
          "variant:reference-compliant"
        ]
      }
    },
    {
      "name": "empty_key_top_level_ocaml_reference",
      "input": "= root_value\nkey = normal\n= another_root",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "",
              "value": "root_value"
            },
            {
              "key": "key",
              "value": "normal"
            },
            {
              "key": "",
              "value": "another_root"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "": [
              "another_root",
              "root_value"
            ],
            "key": "normal"
          }
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:build-hierarchy",
          "function:parse",
          "variant:reference-compliant"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "mixed_flat_and_nested",
      "input": "simple = value\nnested =\n  key1 = val1\n  key2 = val2\nanother = simple",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "simple",
              "value": "value"
            },
            {
              "key": "nested",
              "value": "\n  key1 = val1\n  key2 = val2"
            },
            {
              "key": "another",
              "value": "simple"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "simple": "value",
            "nested": {
              "key1": "val1",
              "key2": "val2"
            },
            "another": "simple"
          }
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    },
    {
      "name": "stress_test_complex_nesting",
      "input": "/ = This is a CCL document\ntitle = CCL Example\n\ndatabase =\n  enabled = true\n  ports =\n    = 8000\n    = 8001\n    = 8002\n  limits =\n    cpu = 1500mi\n    memory = 10Gb\n\nuser =\n  guestId = 42\n\nuser =\n  login = chshersh\n  createdAt = 2024-12-31",
      "validations": {
        "parse": {
          "count": 5,
          "expected": [
            {
              "key": "/",
              "value": "This is a CCL document"
            },
            {
              "key": "title",
              "value": "CCL Example"
            },
            {
              "key": "database",
              "value": "\n  enabled = true\n  ports =\n    = 8000\n    = 8001\n    = 8002\n  limits =\n    cpu = 1500mi\n    memory = 10Gb"
            },
            {
              "key": "user",
              "value": "\n  guestId = 42"
            },
            {
              "key": "user",
              "value": "\n  login = chshersh\n  createdAt = 2024-12-31"
            }
          ]
        },
        "build_hierarchy": {
          "count": 1,
          "expected": {
            "/": "This is a CCL document",
            "title": "CCL Example",
            "database": {
              "enabled": "true",
              "ports": {
                "": [
                  "8000",
                  "8001",
                  "8002"
                ]
              },
              "limits": {
                "cpu": "1500mi",
                "memory": "10Gb"
              }
            },
            "user": {
              "guestId": "42",
              "login": "chshersh",
              "createdAt": "2024-12-31"
            }
          }
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 3,
        "feature": "object-construction"
      }
    }
  ]
}
