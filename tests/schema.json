{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "schema.json",
  "title": "CCL Validation-Based Test Suite Schema",
  "description": "New validation-based JSON Schema for CCL test suites with explicit API function testing",
  "type": "object",
  "required": ["suite", "version", "tests"],
  "properties": {
    "suite": {
      "type": "string",
      "description": "Name of the test suite (e.g., 'CCL Entry Parsing', 'CCL Object Construction')"
    },
    "version": {
      "type": "string",
      "description": "Version of the test suite format"
    },
    "description": {
      "type": "string",
      "description": "Description of the test suite purpose and scope"
    },
    "tests": {
      "type": "array",
      "description": "Array of test cases with validation-based structure",
      "items": {
        "$ref": "#/definitions/validation_test_case"
      }
    }
  },
  "definitions": {
    "validation_test_case": {
      "type": "object",
      "required": ["name", "input", "validations", "meta"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique name for the test case"
        },
        "input": {
          "type": "string",
          "description": "CCL input string to parse"
        },
        "input1": {
          "type": "string",
          "description": "First CCL input for composition tests"
        },
        "input2": {
          "type": "string",
          "description": "Second CCL input for composition tests"
        },
        "input3": {
          "type": "string",
          "description": "Third CCL input for associativity tests"
        },
        "validations": {
          "type": "object",
          "description": "Object containing test validations - organized by implementation complexity",
          "additionalProperties": false,
          "properties": {
            "parse": {
              "$ref": "#/definitions/parse_validation",
              "description": "API: Level 1 entry parsing validation"
            },
            "parse_value": {
              "$ref": "#/definitions/parse_validation",
              "description": "API: Level 2 entry processing validation (indentation-aware parsing)"
            },
            "filter": {
              "$ref": "#/definitions/filter_validation",
              "description": "API: Level 2 entry filtering validation"
            },
            "compose": {
              "$ref": "#/definitions/compose_validation",
              "description": "API: Level 2 entry composition validation"
            },
            "expand_dotted": {
              "$ref": "#/definitions/expand_dotted_validation",
              "description": "API: Level 2 dotted key expansion validation"
            },
            "make_objects": {
              "$ref": "#/definitions/make_objects_validation",
              "description": "API: Level 3 object construction validation"
            },
            "get_string": {
              "$ref": "#/definitions/typed_access_validation",
              "description": "API: Level 4 string access validation"
            },
            "get_int": {
              "$ref": "#/definitions/typed_access_validation",
              "description": "API: Level 4 integer access validation"
            },
            "get_bool": {
              "$ref": "#/definitions/typed_access_validation", 
              "description": "API: Level 4 boolean access validation"
            },
            "get_float": {
              "$ref": "#/definitions/typed_access_validation",
              "description": "API: Level 4 float access validation"
            },
            "pretty_print": {
              "$ref": "#/definitions/pretty_print_validation",
              "description": "API: Output formatting validation"
            },
            "round_trip": {
              "$ref": "#/definitions/round_trip_validation",
              "description": "PROPERTY: Parse-format-parse identity validation"
            },
            "canonical_format": {
              "$ref": "#/definitions/canonical_format_validation",
              "description": "PROPERTY: Canonical formatting validation"
            },
            "associativity": {
              "$ref": "#/definitions/associativity_validation",
              "description": "PROPERTY: Composition associativity validation"
            }
          }
        },
        "meta": {
          "$ref": "#/definitions/test_metadata",
          "description": "Test metadata including level and categorization"
        }
      }
    },
    "parse_validation": {
      "oneOf": [
        {
          "type": "array",
          "description": "Expected entries from parsing",
          "items": {
            "$ref": "#/definitions/entry"
          }
        },
        {
          "$ref": "#/definitions/error_validation",
          "description": "Expected parse error"
        }
      ]
    },
    "filter_validation": {
      "oneOf": [
        {
          "type": "array",
          "description": "Expected entries after filtering",
          "items": {
            "$ref": "#/definitions/entry"
          }
        },
        {
          "$ref": "#/definitions/error_validation"
        }
      ]
    },
    "compose_validation": {
      "oneOf": [
        {
          "type": "object",
          "required": ["left", "right", "expected"],
          "properties": {
            "left": {
              "type": "array",
              "description": "Left entry array for composition",
              "items": {"$ref": "#/definitions/entry"}
            },
            "right": {
              "type": "array", 
              "description": "Right entry array for composition",
              "items": {"$ref": "#/definitions/entry"}
            },
            "expected": {
              "type": "array",
              "description": "Expected result of composition",
              "items": {"$ref": "#/definitions/entry"}
            }
          }
        },
        {
          "$ref": "#/definitions/error_validation"
        }
      ]
    },
    "expand_dotted_validation": {
      "oneOf": [
        {
          "type": "array",
          "description": "Expected entries after dotted key expansion",
          "items": {
            "$ref": "#/definitions/entry"
          }
        },
        {
          "$ref": "#/definitions/error_validation"
        }
      ]
    },
    "make_objects_validation": {
      "oneOf": [
        {
          "type": "object",
          "description": "Expected nested object structure",
          "additionalProperties": true
        },
        {
          "$ref": "#/definitions/error_validation"
        }
      ]
    },
    "typed_access_validation": {
      "oneOf": [
        {
          "type": "object",
          "required": ["args", "expected"],
          "properties": {
            "args": {
              "type": "array",
              "description": "Path arguments for access (supports both hierarchical and dotted)",
              "items": {"type": "string"}
            },
            "expected": {
              "oneOf": [
                {"type": "string"},
                {"type": "number"},
                {"type": "boolean"}
              ],
              "description": "Expected typed value"
            }
          }
        },
        {
          "type": "object",
          "required": ["args", "error"],
          "allOf": [
            {
              "properties": {
                "args": {
                  "type": "array",
                  "items": {"type": "string"}
                }
              }
            },
            {
              "$ref": "#/definitions/error_validation"
            }
          ]
        }
      ]
    },
    "pretty_print_validation": {
      "oneOf": [
        {
          "type": "string",
          "description": "Expected pretty-printed output"
        },
        {
          "$ref": "#/definitions/error_validation"
        }
      ]
    },
    "round_trip_validation": {
      "type": "object",
      "required": ["property"],
      "properties": {
        "property": {
          "type": "string",
          "enum": ["identity"],
          "description": "Round-trip property to validate"
        },
        "description": {
          "type": "string",
          "description": "Description of the round-trip test"
        }
      }
    },
    "canonical_format_validation": {
      "type": "object",
      "required": ["expected"],
      "properties": {
        "expected": {
          "type": "string",
          "description": "Expected canonical formatted output"
        },
        "description": {
          "type": "string",
          "description": "Description of canonical formatting"
        }
      }
    },
    "associativity_validation": {
      "type": "object",
      "required": ["property", "should_be_equal"],
      "properties": {
        "property": {
          "type": "string",
          "enum": ["semigroup_associativity", "monoid_identity_left", "monoid_identity_right"],
          "description": "Algebraic property being tested"
        },
        "left_assoc": {
          "type": "string",
          "description": "Left associative expression description"
        },
        "right_assoc": {
          "type": "string", 
          "description": "Right associative expression description"
        },
        "should_be_equal": {
          "type": "boolean",
          "description": "Whether left and right associative results should be equal"
        }
      }
    },
    "error_validation": {
      "type": "object",
      "required": ["error"],
      "properties": {
        "error": {
          "type": "boolean",
          "const": true,
          "description": "Indicates this validation expects an error"
        },
        "error_type": {
          "type": "string",
          "enum": ["ParseError", "AccessError", "TypeError", "ValidationError"],
          "description": "Expected error type"
        },
        "error_pattern": {
          "type": "string",
          "description": "Expected error message pattern (regex)"
        },
        "error_message": {
          "type": "string",
          "description": "Expected exact error message"
        }
      }
    },
    "entry": {
      "type": "object",
      "required": ["key", "value"],
      "properties": {
        "key": {
          "type": "string",
          "description": "The key part of the entry"
        },
        "value": {
          "type": "string",
          "description": "The value part of the entry"
        }
      }
    },
    "test_metadata": {
      "type": "object",
      "required": ["tags", "level"],
      "properties": {
        "tags": {
          "type": "array",
          "description": "Tags for categorizing and filtering tests",
          "items": {
            "type": "string"
          }
        },
        "level": {
          "type": "integer",
          "enum": [1, 2, 3, 4],
          "description": "CCL architecture level (1=Entry Parsing, 2=Processing, 3=Objects, 4=Typed)"
        },
        "feature": {
          "type": "string",
          "enum": ["parsing", "processing", "comments", "object-construction", "dotted-keys", "typed-parsing", "pretty-printing", "error-handling"],
          "description": "Feature category for test organization and filtering"
        },
        "difficulty": {
          "type": "string",
          "enum": ["basic", "intermediate", "advanced"],
          "description": "Test difficulty level"
        }
      }
    }
  }
}