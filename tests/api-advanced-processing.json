{
  "$schema": "./schema.json",
  "suite": "CCL Advanced Processing - Validation Format",
  "version": "2.1",
  "description": "Advanced entry processing, composition, and merging - Level 3 power user functionality for complex configurations.",
  "llm_metadata": {
    "llm_description": "Level 3 CCL advanced processing - composition, merging, and power user functionality for complex configuration manipulation",
    "complexity_level": "Level 3 (Advanced Processing)",
    "prerequisite_tests": ["api-core-ccl-parsing.json", "api-core-ccl-hierarchy.json", "api-core-ccl-integration.json", "api-typed-access.json"],
    "related_functions": ["filter", "compose", "expand-dotted"],
    "implementation_notes": "Level 3 advanced functionality. Requires working Core CCL (Level 1) and typed access (Level 2). Power user features for complex config manipulation.",
    "test_count": 19,
    "assertion_count": 67,
    "cross_references": {
      "gleam_implementation": "packages/ccl/src/ccl.gleam#compose",
      "go_reference": "internal/mock/ccl.go#Compose",
      "documentation": "https://ccl.tylerbutler.com/api-reference#processing"
    },
    "learning_path": "Requires Core CCL (Level 1) + Typed Access (Level 2) → Implement here → api-experimental.json (Level 4)"
  },
  "tests": [
    {
      "name": "composition_stability_duplicate_keys",
      "input": "a = 1\nb = 2\nb = 20\nc = 3",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "a",
              "value": "1"
            },
            {
              "key": "b",
              "value": "2"
            },
            {
              "key": "b",
              "value": "20"
            },
            {
              "key": "c",
              "value": "3"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "multiple_values_same_key",
      "input": "ports = 8000\nports = 8001\nports = 8002",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "ports",
              "value": "8000"
            },
            {
              "key": "ports",
              "value": "8001"
            },
            {
              "key": "ports",
              "value": "8002"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "list_with_empty_keys",
      "input": "= 3\n= 1\n= 2",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "",
              "value": "3"
            },
            {
              "key": "",
              "value": "1"
            },
            {
              "key": "",
              "value": "2"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_style_syntax",
      "input": "== Section 2 ==",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {
              "key": "",
              "value": "= Section 2 =="
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "composition_stability_ba",
      "input": "b = 20\nc = 3\na = 1\nb = 2",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "b",
              "value": "20"
            },
            {
              "key": "c",
              "value": "3"
            },
            {
              "key": "a",
              "value": "1"
            },
            {
              "key": "b",
              "value": "2"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "mixed_keys_with_duplicates",
      "input": "name = app\nports = 8000\nname = service\nports = 8001",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "name",
              "value": "app"
            },
            {
              "key": "ports",
              "value": "8000"
            },
            {
              "key": "name",
              "value": "service"
            },
            {
              "key": "ports",
              "value": "8001"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:build-hierarchy",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "array_style_list",
      "input": "1 =\n2 =\n3 =",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "1",
              "value": ""
            },
            {
              "key": "2",
              "value": ""
            },
            {
              "key": "3",
              "value": ""
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_header_double_equals",
      "input": "== Database Config ==\nhost = localhost\nport = 5432",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "",
              "value": "= Database Config =="
            },
            {
              "key": "host",
              "value": "localhost"
            },
            {
              "key": "port",
              "value": "5432"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_header_triple_equals",
      "input": "=== Server Settings ===\nhost = 0.0.0.0\nssl = true",
      "validations": {
        "parse": {
          "count": 3,
          "expected": [
            {
              "key": "",
              "value": "== Server Settings ==="
            },
            {
              "key": "host",
              "value": "0.0.0.0"
            },
            {
              "key": "ssl",
              "value": "true"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "multiple_sections_with_entries",
      "input": "== Database ==\nhost = localhost\n\n=== Cache ===\nredis = enabled\n\n== Logging ==\nlevel = info",
      "validations": {
        "parse": {
          "count": 6,
          "expected": [
            {
              "key": "",
              "value": "= Database =="
            },
            {
              "key": "host",
              "value": "localhost"
            },
            {
              "key": "",
              "value": "== Cache ==="
            },
            {
              "key": "redis",
              "value": "enabled"
            },
            {
              "key": "",
              "value": "= Logging =="
            },
            {
              "key": "level",
              "value": "info"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_headers_mixed_with_lists",
      "input": "== Configuration ==\n= item1\n= item2\nkey = value\n=== Next Section ===\nother = data",
      "validations": {
        "parse": {
          "count": 6,
          "expected": [
            {
              "key": "",
              "value": "= Configuration =="
            },
            {
              "key": "",
              "value": "item1"
            },
            {
              "key": "",
              "value": "item2"
            },
            {
              "key": "key",
              "value": "value"
            },
            {
              "key": "",
              "value": "== Next Section ==="
            },
            {
              "key": "other",
              "value": "data"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "empty_section_header_only",
      "input": "== Empty Section ==",
      "validations": {
        "parse": {
          "count": 1,
          "expected": [
            {
              "key": "",
              "value": "= Empty Section =="
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_header_at_end",
      "input": "key = value\n== Final Section ==",
      "validations": {
        "parse": {
          "count": 2,
          "expected": [
            {
              "key": "key",
              "value": "value"
            },
            {
              "key": "",
              "value": "= Final Section =="
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_headers_no_trailing_equals",
      "input": "== Database Config\nhost = localhost\n=== Server Settings\nport = 8080",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "",
              "value": "= Database Config"
            },
            {
              "key": "host",
              "value": "localhost"
            },
            {
              "key": "",
              "value": "== Server Settings"
            },
            {
              "key": "port",
              "value": "8080"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "section_headers_with_colons",
      "input": "== Database: Production ==\nhost = db.prod.com\n=== Cache: Redis Config ===\nport = 6379",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "",
              "value": "= Database: Production =="
            },
            {
              "key": "host",
              "value": "db.prod.com"
            },
            {
              "key": "",
              "value": "== Cache: Redis Config ==="
            },
            {
              "key": "port",
              "value": "6379"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "spaced_equals_not_section_header",
      "input": "= = spaced equals\n=  = wide spaces\n== Real Header ==\nkey = value",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "",
              "value": "= spaced equals"
            },
            {
              "key": "",
              "value": "= wide spaces"
            },
            {
              "key": "",
              "value": "= Real Header =="
            },
            {
              "key": "key",
              "value": "value"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "consecutive_section_headers",
      "input": "== First Section ==\n=== Nested Section ===\n==== Deep Section ====\nkey = value",
      "validations": {
        "parse": {
          "count": 4,
          "expected": [
            {
              "key": "",
              "value": "= First Section =="
            },
            {
              "key": "",
              "value": "== Nested Section ==="
            },
            {
              "key": "",
              "value": "=== Deep Section ===="
            },
            {
              "key": "key",
              "value": "value"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse"
        ],
        "level": 2,
        "feature": "processing"
      }
    },
    {
      "name": "multiline_section_header_value",
      "input": "== Section Header =\n  This continues the header\nkey = value",
      "validations": {
        "parse_value": {
          "count": 2,
          "expected": [
            {
              "key": "",
              "value": "= Section Header =\n  This continues the header"
            },
            {
              "key": "key",
              "value": "value"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "feature:multiline",
          "function:parse-value",
          "variant:proposed-behavior"
        ],
        "level": 2,
        "feature": "processing",
        "conflicts": [
          "variant:reference-compliant"
        ]
      }
    },
    {
      "name": "unindented_multiline_becomes_continuation",
      "input": "== Section Header =\nThis continues the header\nkey = value",
      "validations": {
        "parse_value": {
          "count": 2,
          "expected": [
            {
              "key": "",
              "value": "= Section Header =\nThis continues the header"
            },
            {
              "key": "key",
              "value": "value"
            }
          ]
        }
      },
      "meta": {
        "tags": [
          "feature:empty-keys",
          "function:parse-value",
          "variant:proposed-behavior"
        ],
        "level": 2,
        "feature": "processing",
        "conflicts": [
          "variant:reference-compliant"
        ]
      }
    }
  ]
}
