{
  "$schema": "../../schemas/source-format.json",
  "tests": [
    {
      "name": "multiline_section_header_value",
      "tests": [
        {
          "function": "parse_indented",
          "expect": [
            {
              "key": "",
              "value": "= Section Header =\n  This continues the header"
            },
            {
              "key": "key",
              "value": "value"
            }
          ]
        }
      ],
      "features": [
        "empty_keys",
        "multiline"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "== Section Header =\n  This continues the header\nkey = value"
      ]
    },
    {
      "name": "unindented_multiline_becomes_continuation",
      "tests": [
        {
          "function": "parse_indented",
          "expect": [
            {
              "key": "",
              "value": "= Section Header =\nThis continues the header"
            },
            {
              "key": "key",
              "value": "value"
            }
          ]
        }
      ],
      "features": [
        "empty_keys"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "== Section Header =\nThis continues the header\nkey = value"
      ]
    },
    {
      "name": "indented_line_is_continuation",
      "tests": [
        {
          "function": "parse_indented",
          "expect": [
            {
              "key": "descriptions",
              "value": "First line\n  second line"
            },
            {
              "key": "descriptions",
              "value": "Another item"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "descriptions": [
              "First line\n  second line",
              "Another item"
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "First line\n  second line",
            "Another item"
          ],
          "args": [
            "descriptions"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "features": [
        "multiline"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "descriptions = First line\n  second line\ndescriptions = Another item"
      ]
    },
    {
      "name": "mixed_indentation_levels",
      "tests": [
        {
          "function": "parse_indented",
          "expect": [
            {
              "key": "key1",
              "value": "value1\n  indented continuation"
            },
            {
              "key": "key2",
              "value": "value2"
            },
            {
              "key": "not indented key",
              "value": ""
            },
            {
              "key": "indented for not indented",
              "value": ""
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "key1": "value1\n  indented continuation",
            "key2": "value2",
            "not indented key": {
              "indented for not indented": ""
            }
          }
        }
      ],
      "features": [
        "multiline",
        "empty_keys"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "key1 = value1\n  indented continuation\nkey2 = value2\nnot indented key\n  indented for not indented"
      ]
    },
    {
      "name": "single_item_as_list",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "item",
              "value": "single"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "item": "single"
          }
        },
        {
          "function": "get_list",
          "expect": [
            "single"
          ],
          "args": [
            "item"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "item = single"
      ]
    },
    {
      "name": "mixed_duplicate_single_keys",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "ports",
              "value": "80"
            },
            {
              "key": "ports",
              "value": "443"
            },
            {
              "key": "host",
              "value": "localhost"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "host": "localhost",
            "ports": [
              "80",
              "443"
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "80",
            "443"
          ],
          "args": [
            "ports"
          ]
        },
        {
          "function": "get_list",
          "expect": [
            "localhost"
          ],
          "args": [
            "host"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "ports = 80\nports = 443\nhost = localhost"
      ]
    },
    {
      "name": "nested_list_access",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "database",
              "value": "\n  hosts = primary\n  hosts = secondary\n  port = 5432"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "database": {
              "hosts": [
                "primary",
                "secondary"
              ],
              "port": "5432"
            }
          }
        },
        {
          "function": "get_list",
          "expect": [
            "primary",
            "secondary"
          ],
          "args": [
            "database",
            "hosts"
          ]
        },
        {
          "function": "get_list",
          "expect": [
            "5432"
          ],
          "args": [
            "database",
            "port"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "database =\n  hosts = primary\n  hosts = secondary\n  port = 5432"
      ]
    },
    {
      "name": "empty_list",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "empty_list",
              "value": ""
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "empty_list": ""
          }
        },
        {
          "function": "get_list",
          "expect": [
            ""
          ],
          "args": [
            "empty_list"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "empty_list ="
      ]
    },
    {
      "name": "list_with_numbers",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "numbers",
              "value": "1"
            },
            {
              "key": "numbers",
              "value": "42"
            },
            {
              "key": "numbers",
              "value": "-17"
            },
            {
              "key": "numbers",
              "value": "0"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "numbers": [
              "1",
              "42",
              "-17",
              "0"
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "1",
            "42",
            "-17",
            "0"
          ],
          "args": [
            "numbers"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "numbers = 1\nnumbers = 42\nnumbers = -17\nnumbers = 0"
      ]
    },
    {
      "name": "list_with_booleans",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "flags",
              "value": "true"
            },
            {
              "key": "flags",
              "value": "false"
            },
            {
              "key": "flags",
              "value": "yes"
            },
            {
              "key": "flags",
              "value": "no"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "flags": [
              "true",
              "false",
              "yes",
              "no"
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "true",
            "false",
            "yes",
            "no"
          ],
          "args": [
            "flags"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "flags = true\nflags = false\nflags = yes\nflags = no"
      ]
    },
    {
      "name": "list_with_whitespace",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "items",
              "value": "spaced"
            },
            {
              "key": "items",
              "value": "normal"
            },
            {
              "key": "items",
              "value": ""
            },
            {
              "key": "items",
              "value": ""
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "items": [
              "spaced",
              "normal",
              "",
              ""
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "spaced",
            "normal",
            "",
            ""
          ],
          "args": [
            "items"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "features": [
        "whitespace"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "items =   spaced   \nitems = normal\nitems =\nitems =   "
      ]
    },
    {
      "name": "deeply_nested_list",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "config",
              "value": ""
            },
            {
              "key": "environments",
              "value": ""
            },
            {
              "key": "production",
              "value": ""
            },
            {
              "key": "servers",
              "value": "web1"
            },
            {
              "key": "servers",
              "value": "web2"
            },
            {
              "key": "servers",
              "value": "api1"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "config": {
              "environments": {
                "production": {
                  "servers": [
                    "web1",
                    "web2",
                    "api1"
                  ]
                }
              }
            }
          }
        },
        {
          "function": "get_list",
          "expect": [
            "web1",
            "web2",
            "api1"
          ],
          "args": [
            "config",
            "environments",
            "production",
            "servers"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "config =\n  environments =\n    production =\n      servers = web1\n      servers = web2\n      servers = api1"
      ]
    },
    {
      "name": "list_with_unicode",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "names",
              "value": "å¼ ä¸‰"
            },
            {
              "key": "names",
              "value": "JosÃ©"
            },
            {
              "key": "names",
              "value": "FranÃ§ois"
            },
            {
              "key": "names",
              "value": "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "names": [
              "å¼ ä¸‰",
              "JosÃ©",
              "FranÃ§ois",
              "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "å¼ ä¸‰",
            "JosÃ©",
            "FranÃ§ois",
            "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
          ],
          "args": [
            "names"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "features": [
        "unicode"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "names = å¼ ä¸‰\nnames = JosÃ©\nnames = FranÃ§ois\nnames = Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"
      ]
    },
    {
      "name": "list_with_special_characters",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "symbols",
              "value": "@#$%"
            },
            {
              "key": "symbols",
              "value": "!^&*()"
            },
            {
              "key": "symbols",
              "value": "[]{}|"
            },
            {
              "key": "symbols",
              "value": "<>=+"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "symbols": [
              "@#$%",
              "!^&*()",
              "[]{}|",
              "<>=+"
            ]
          }
        },
        {
          "function": "get_list",
          "expect": [
            "@#$%",
            "!^&*()",
            "[]{}|",
            "<>=+"
          ],
          "args": [
            "symbols"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "symbols = @#$%\nsymbols = !^&*()\nsymbols = []{}|\nsymbols = <>=+"
      ]
    },
    {
      "name": "list_multiline_values",
      "tests": [
        {
          "function": "build_hierarchy",
          "expect": {
            "descriptions": [
              "First line",
              "Another item",
              "Third item"
            ],
            "second line": ""
          }
        },
        {
          "function": "get_list",
          "expect": [
            "First line",
            "Another item",
            "Third item"
          ],
          "args": [
            "descriptions"
          ]
        },
        {
          "function": "parse_indented",
          "expect": [
            {
              "key": "descriptions",
              "value": "First line"
            },
            {
              "key": "second line",
              "value": ""
            },
            {
              "key": "descriptions",
              "value": "Another item"
            },
            {
              "key": "descriptions",
              "value": "Third item"
            }
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "features": [
        "multiline"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "descriptions = First line\nsecond line\ndescriptions = Another item\ndescriptions = Third item"
      ]
    },
    {
      "name": "complex_mixed_list_scenarios",
      "tests": [
        {
          "function": "get_list",
          "expect": [
            "web1",
            "web2"
          ],
          "args": [
            "config",
            "servers"
          ]
        },
        {
          "function": "get_list",
          "expect": [
            "primary",
            "backup"
          ],
          "args": [
            "config",
            "database",
            "hosts"
          ]
        },
        {
          "function": "get_list",
          "expect": [
            "redis"
          ],
          "args": [
            "config",
            "cache"
          ]
        },
        {
          "function": "get_list",
          "expect": [
            "auth",
            "api",
            "ui"
          ],
          "args": [
            "features"
          ]
        },
        {
          "function": "parse_indented",
          "expect": [
            {
              "key": "config",
              "value": ""
            },
            {
              "key": "servers",
              "value": "web1"
            },
            {
              "key": "servers",
              "value": "web2"
            },
            {
              "key": "database",
              "value": ""
            },
            {
              "key": "hosts",
              "value": "primary"
            },
            {
              "key": "hosts",
              "value": "backup"
            },
            {
              "key": "port",
              "value": "5432"
            },
            {
              "key": "cache",
              "value": "redis"
            },
            {
              "key": "features",
              "value": "auth"
            },
            {
              "key": "features",
              "value": "api"
            },
            {
              "key": "features",
              "value": "ui"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "config": {
              "cache": "redis",
              "database": {
                "hosts": [
                  "primary",
                  "backup"
                ],
                "port": "5432"
              },
              "servers": [
                "web1",
                "web2"
              ]
            },
            "features": [
              "auth",
              "api",
              "ui"
            ]
          }
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "config =\n  servers = web1\n  servers = web2\n  database =\n    hosts = primary\n    hosts = backup\n    port = 5432\n  cache = redis\nfeatures = auth\nfeatures = api\nfeatures = ui"
      ]
    },
    {
      "name": "list_path_traversal_protection",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "safe",
              "value": "value"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "safe": "value"
          }
        },
        {
          "function": "get_list",
          "expect": null,
          "args": [
            ""
          ]
        },
        {
          "function": "get_list",
          "expect": null
        },
        {
          "function": "get_list",
          "expect": [
            "value"
          ],
          "args": [
            "safe"
          ]
        }
      ],
      "behaviors": [
        "list_coercion_enabled"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "safe = value"
      ]
    },
    {
      "name": "parse_empty_value",
      "tests": [
        {
          "function": "build_hierarchy",
          "expect": {
            "empty_key": ""
          }
        },
        {
          "function": "get_string",
          "expect": "",
          "args": [
            "empty_key"
          ]
        },
        {
          "function": "parse",
          "expect": [
            {
              "key": "empty_key",
              "value": ""
            }
          ]
        }
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "empty_key ="
      ]
    },
    {
      "name": "canonical_format_empty_values",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "empty_key",
              "value": ""
            }
          ]
        },
        {
          "function": "canonical_format",
          "expect": "empty_key ="
        }
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "empty_key ="
      ]
    },
    {
      "name": "canonical_format_tab_preservation",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "value_with_tabs",
              "value": "text\t\twith\ttabs\t"
            }
          ]
        },
        {
          "function": "canonical_format",
          "expect": "value_with_tabs = text\t\twith\ttabs"
        }
      ],
      "behaviors": [
        "tabs_preserve"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "value_with_tabs = text\t\twith\ttabs\t"
      ]
    },
    {
      "name": "canonical_format_unicode",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "unicode",
              "value": "ä½ å¥½ä¸–ç•Œ"
            },
            {
              "key": "emo",
              "value": "ðŸŒŸâœ¨"
            }
          ]
        },
        {
          "function": "canonical_format",
          "expect": "unicode = ä½ å¥½ä¸–ç•Œ\nemo = ðŸŒŸâœ¨"
        }
      ],
      "features": [
        "unicode"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "unicode = ä½ å¥½ä¸–ç•Œ\nemo = ðŸŒŸâœ¨"
      ]
    },
    {
      "name": "canonical_format_line_endings_proposed",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "key1",
              "value": "value1"
            },
            {
              "key": "key2",
              "value": "value2"
            }
          ]
        },
        {
          "function": "canonical_format",
          "expect": "key1 = value1\nkey2 = value2"
        }
      ],
      "behaviors": [
        "crlf_preserve_literal"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "key1 = value1\r\nkey2 = value2\r\n"
      ]
    },
    {
      "name": "crlf_normalize_to_lf_proposed",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "key1",
              "value": "value1"
            },
            {
              "key": "key2",
              "value": "value2"
            }
          ]
        },
        {
          "function": "canonical_format",
          "expect": "key1 = value1\nkey2 = value2"
        }
      ],
      "behaviors": [
        "crlf_normalize_to_lf"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "key1 = value1\r\nkey2 = value2\r\n"
      ]
    },
    {
      "name": "crlf_normalize_to_lf_indented_proposed",
      "tests": [
        {
          "function": "canonical_format",
          "expect": "key1 =\n  value1 =\nkey2 =\n  value2 =\n"
        },
        {
          "function": "parse",
          "expect": [
            {
              "key": "key1",
              "value": "value1"
            },
            {
              "key": "key2",
              "value": "value2"
            }
          ]
        }
      ],
      "behaviors": [
        "crlf_normalize_to_lf"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "key1 = value1\r\nkey2 = value2\r\n"
      ]
    },
    {
      "name": "canonical_format_consistent_spacing",
      "tests": [
        {
          "function": "canonical_format",
          "expect": "key1 = value1\nkey2 = value2\nkey3 = \tvalue3"
        },
        {
          "function": "parse",
          "expect": [
            {
              "key": "key1",
              "value": "value1"
            },
            {
              "key": "key2",
              "value": "value2"
            },
            {
              "key": "key3",
              "value": "\tvalue3"
            }
          ]
        }
      ],
      "behaviors": [
        "strict_spacing"
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "key1=value1\nkey2  =  value2\nkey3\t=\tvalue3"
      ]
    },
    {
      "name": "deterministic_output",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "z",
              "value": "last"
            },
            {
              "key": "a",
              "value": "first"
            },
            {
              "key": "m",
              "value": "middle"
            }
          ]
        },
        {
          "function": "canonical_format",
          "expect": "z = last\na = first\nm = middle"
        }
      ],
      "variants": [
        "proposed_behavior"
      ],
      "inputs": [
        "z = last\na = first\nm = middle"
      ]
    }
  ]
}
