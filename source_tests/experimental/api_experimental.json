{
  "$schema": "../../schemas/source-format.json",
  "tests": [
    {
      "name": "basic_dotted_key_expansion",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "database.host",
              "value": "localhost"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "database": {
              "host": "localhost"
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "database.host = localhost"
      ]
    },
    {
      "name": "multiple_dotted_keys",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "database.host",
              "value": "localhost"
            },
            {
              "key": "database.port",
              "value": "5432"
            },
            {
              "key": "app.name",
              "value": "MyApp"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "app": {
              "name": "MyApp"
            },
            "database": {
              "host": "localhost",
              "port": "5432"
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "database.host = localhost\ndatabase.port = 5432\napp.name = MyApp"
      ]
    },
    {
      "name": "deep_dotted_nesting",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "server.database.credentials.user",
              "value": "admin"
            },
            {
              "key": "server.database.credentials.pass",
              "value": "secret"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "server": {
              "database": {
                "credentials": {
                  "pass": "secret",
                  "user": "admin"
                }
              }
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "server.database.credentials.user = admin\nserver.database.credentials.pass = secret"
      ]
    },
    {
      "name": "mixed_dotted_and_regular_keys",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "app",
              "value": "MyApp"
            },
            {
              "key": "database.host",
              "value": "localhost"
            },
            {
              "key": "config",
              "value": "\n  debug = true"
            },
            {
              "key": "logging.level",
              "value": "info"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "app": "MyApp",
            "config": {
              "debug": "true"
            },
            "database": {
              "host": "localhost"
            },
            "logging": {
              "level": "info"
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "app = MyApp\ndatabase.host = localhost\nconfig =\n  debug = true\nlogging.level = info"
      ]
    },
    {
      "name": "dotted_key_conflicts_resolution",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "database",
              "value": "old_value"
            },
            {
              "key": "database.host",
              "value": "localhost"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "database": {
              "host": "localhost"
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "database = old_value\ndatabase.host = localhost"
      ]
    },
    {
      "name": "dotted_keys_with_lists",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "servers.web",
              "value": "web1"
            },
            {
              "key": "servers.web",
              "value": "web2"
            },
            {
              "key": "servers.api",
              "value": "api1"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "servers": {
              "api": "api1",
              "web": [
                "web1",
                "web2"
              ]
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "servers.web = web1\nservers.web = web2\nservers.api = api1"
      ]
    },
    {
      "name": "empty_dotted_key_segments",
      "tests": [
        {
          "function": "build_hierarchy",
          "expect": {
            "a": {
              "": {
                "b": "value"
              }
            }
          }
        },
        {
          "function": "parse",
          "expect": [
            {
              "key": "a..b",
              "value": "value"
            }
          ]
        }
      ],
      "features": [
        "experimental_dotted_keys",
        "empty_keys"
      ],
      "inputs": [
        "a..b = value"
      ]
    },
    {
      "name": "single_dot_key",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "a.",
              "value": "value"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "a": {
              "": "value"
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys",
        "empty_keys"
      ],
      "inputs": [
        "a. = value"
      ]
    },
    {
      "name": "hierarchical_with_expand_dotted_validation",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "database",
              "value": "\n  enabled = true\n  port = 5432"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "database": {
              "enabled": "true",
              "port": "5432"
            }
          }
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "database =\n  enabled = true\n  port = 5432"
      ]
    },
    {
      "name": "dotted_key_list_access",
      "tests": [
        {
          "function": "parse",
          "expect": [
            {
              "key": "database.hosts",
              "value": "primary"
            },
            {
              "key": "database.hosts",
              "value": "secondary"
            },
            {
              "key": "database.port",
              "value": "5432"
            }
          ]
        },
        {
          "function": "build_hierarchy",
          "expect": {
            "database": {
              "hosts": [
                "primary",
                "secondary"
              ],
              "port": "5432"
            }
          }
        },
        {
          "function": "get_list",
          "expect": [
            "primary",
            "secondary"
          ],
          "args": [
            "database",
            "hosts"
          ]
        },
        {
          "function": "get_list",
          "expect": [
            "5432"
          ],
          "args": [
            "database",
            "port"
          ]
        }
      ],
      "features": [
        "experimental_dotted_keys"
      ],
      "inputs": [
        "database.hosts = primary\ndatabase.hosts = secondary\ndatabase.port = 5432"
      ]
    }
  ]
}
